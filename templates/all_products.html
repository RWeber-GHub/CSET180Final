{% extends "base.html" %}

{% block content %}
<div class="container">
    <header>
        <div class="header-links">
            <a href="{{ url_for('user.user') }}" class="link">User Dashboard</a>
            <a href="{{ url_for('user.cart') }}" class="link">Cart</a>
            <a href="{{ url_for('user.view_orders') }}" class="link">Orders</a>
        </div>
    </header>
<h1>Marketplace</h1>
<div class="product-gallery" style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center; padding: 2rem;">
    {% for product in products %}
    <div class="product-card" style="border: 1px solid #ccc; border-radius: 10px; padding: 1rem; width: 300px;">
        <div class="product-images" style="margin-bottom: 1rem;">
            {% if product.images %}
            <div id="carousel-{{ product.product_id }}" class="carousel" style="position: relative;">
                <img src="{{ url_for('static', filename=product.images[0].replace('static\\', '').replace('\\', '/')) }}"
                id="carousel-img-{{ product.product_id }}"
                style="width: 100%; height: auto; border-radius: 10px;">


                {% if product.images|length > 1 %}
                <button 
                    class="next-btn" 
                    data-product-id="{{ product.product_id }}" 
                    data-images='[{% for img in product.images %}
                    "{{ img.replace('static\\', '').replace('\\', '/') }}"{% if not loop.last %},{% endif %}
                    {% endfor %}]'

                    style="position: absolute; right: 5px; bottom: 5px;">
                    Next
                </button>
                {% endif %}
            </div>
            {% else %}
            <p>No images</p>
            {% endif %}
        </div>

        <h3>{{ product.title }}</h3>
        <p>{{ product.description }}</p>
        <p><strong>Price:</strong> ${{ "%.2f"|format(product.price) }}</p>
        <p><strong>Stock:</strong> {{ product.stock }}</p>
        <p><strong>Warranty:</strong> {{ product.warranty }}</p>

        {% if product.colors %}
        <div class="product-colors" style="margin-top: 0.5rem;">
            <strong>Colors:</strong>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.25rem;">
                {% for color in product.colors %}
                <div title="{{ color }}" style="width: 20px; height: 20px; border-radius: 50%; background-color: '{{ color }}'; border: 1px solid #000;"></div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if product.sizes %}
        <div class="product-sizes" style="margin-top: 0.5rem;">
            <strong>Sizes:</strong>
            <div>
                {% for size in product.sizes %}
                <span style="margin-right: 5px;">{{ size }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        <form method="POST" action="{{ url_for('user.products') }}">
            <input type="hidden" name="product_id" value="{{ product.product_id }}">
            <!-- <input type="hidden" name="color" value="{{ product.color }}">
            <input type="hidden" name="size" value="{{ product.size }}"> -->
            <input type="number" name="quantity" min="1" max="{{ product.stock }}" required>
            <input type="submit" value="Add to Cart">
        </form>
        <div class="product-card">
            <h3>{{ product.title }}</h3>
            <p>{{ product.description }}</p>
            <a href="{{ url_for('products.edit_product', product_id=product.product_id) }}">
                <button>Edit Product</button>
            </a>
        </div>
    </div>
    {% endfor %}
</div>
<style>
    header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}
.link {
    text-decoration: none;
    font-size: 16px;
    color: white;
    font-weight: bold;
    transition: color 0.3s ease;
    padding-top: 20px;
}
.link:hover {
    color: #ab67eb;
}
.header-links {
    display: flex;
    gap: 20px;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.next-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const productId = btn.dataset.productId;
            const images = JSON.parse(btn.dataset.images);
            const img = document.getElementById('carousel-img-' + productId);

            const currentSrc = img.src.split('/static/')[1];
            const currentIndex = images.indexOf(currentSrc);
            const nextIndex = (currentIndex + 1) % images.length;
            img.src = `/static/${images[nextIndex]}`;

        });
    });
});
</script>
{% endblock %}
