{% extends 'base.html' %}

{% block content %}
<style>
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }

  .product-card {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
  }

  .product-img-container {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
    border-radius: 6px;
  }

  .product-img-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(255,255,255,0.8);
    border: none;
    border-radius: 4px;
    padding: 5px 10px;
    cursor: pointer;
  }

  .carousel-btn.left {
    left: 10px;
  }

  .carousel-btn.right {
    right: 10px;
  }

  .color-swatch {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 1px solid #ccc;
    margin-right: 5px;
    display: inline-block;
  }

  .size-select {
    width: 100%;
    padding: 6px;
    margin-top: 5px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
</style>

<h1>Product Gallery</h1>

<div class="product-grid">
  {% for product in products %}
    <div class="product-card">

      <div class="product-img-container"
           id="carousel-{{ loop.index0 }}"
           data-images='{{ product.images | tojson | safe }}'
           data-index="0">

        {% if product.images %}
          <img src="{{ product.images[0] }}" id="img-{{ loop.index0 }}-active" alt="Product Image">

          {% if product.images|length > 1 %}
          <button class="carousel-btn left" data-action="prev" data-target="{{ loop.index0 }}">←</button>
          <button class="carousel-btn right" data-action="next" data-target="{{ loop.index0 }}">→</button>
          
          {% endif %}
        {% else %}
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #eee;">
            No Image
          </div>
        {% endif %}
      </div>

      <h2 style="margin-top: 10px;">{{ product.title }}</h2>
      <p style="font-size: 14px; color: #666;">{{ product.description }}</p>
      <p style="font-weight: bold; margin: 5px 0;">${{ "%.2f"|format(product.price) }}</p>

      <!-- Color Swatches -->
      <div style="margin-top: 10px;">
        {% for color in product.colors %}
        {% set bg_color = color if color.startswith('#') else '#' + color %}
        
        <div class="color-swatch" title="{{ color }}" style="background-color: {{ bg_color }};"></div>
        
        {% endfor %}
      </div>

      <div style="margin-top: 10px;">
        <label style="font-size: 14px;">Available Sizes:</label>
        <select class="size-select">
          {% for size in product.sizes %}
            <option>{{ size }}</option>
          {% endfor %}
        </select>
      </div>

    </div>
  {% endfor %}
</div>

<script>
  function prevImage(i) {
    const container = document.getElementById(`carousel-${i}`);
    const images = JSON.parse(container.dataset.images);
    let index = parseInt(container.dataset.index);
    index = (index - 1 + images.length) % images.length;
    container.dataset.index = index;
    document.getElementById(`img-${i}-active`).src = images[index];
  }

  function nextImage(i) {
    const container = document.getElementById(`carousel-${i}`);
    const images = JSON.parse(container.dataset.images);
    let index = parseInt(container.dataset.index);
    index = (index + 1) % images.length;
    container.dataset.index = index;
    document.getElementById(`img-${i}-active`).src = images[index];
  }
</script>
{% endblock %}
